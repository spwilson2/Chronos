Init()

RELOCATE_FLAGS = ['-melf_i386', '-r']

# Create a copy of the kernel environment so we don't have to carry the arch
# include path with use manually by exporting it.
arch_env = kenv.Clone()
add_include_path(arch_env, 'include')
add_flags(arch_env, ASFLAGS='-D__BOOT_STRAP__')
add_global_env(arch_env=arch_env)

arch_obj = Target()
export(arch_obj=arch_obj)

include('./tools')

mkvect = import_tool('tools', 'mkvect')
mkvect(target='trap/idt.S', source=None)

include('./signal')
include('./syscall')
include('./src')
include('./context')
include('./x86')
include('./trap')
include('./lock')
include('./vm')
include('./drivers')
include('./boot')
include('./proc')

add_flags(arch_env, LINKFLAGS=RELOCATE_FLAGS)
kobj['y'] += arch_env.Program(target='arch.o', source=arch_obj['y'])

