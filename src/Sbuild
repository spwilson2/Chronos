Init()

APATH = joinpath('arch', kconfig.SRCARCH)
ADIR = Dir(APATH)

export(ADIR=ADIR)

include('kernel')
include('user')
include(APATH)

KLINKFLAGS = ['-nostdlib', '--entry=main', '--section-start=.text=0xFF000000']

add_flags(kenv, LINKFLAGS=KLINKFLAGS)
kobj = kenv.Program(target='chronos.o', source=kobj['y'])
export(kobj=kobj)

Default(kobj)

Tool('hello.sh', None, '$TOOLPATH')

# The boot item needs to be the last thing built
include(joinpath('arch', 'i386', 'boot'))
